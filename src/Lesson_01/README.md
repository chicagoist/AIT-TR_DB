
    Установка сервера и Beekeeper Studio
    БД и СУБД
    Таблица, строки, столбцы, primary key, нормализация в общих словах
    SQL запросы - практика

**Основы реляционных БД**

Система управления базами данных, СУБД — специальная программа-сервер позволяющая использовать и управлять базами данных. СУБД позволяет читать и записывать данные, искать по ним и выполнять сложные выборки.
База данных

БД — фактически создаваемые на диске файлы, в которых хранится информация записанная с помощью СУБД

Важно! Часто значение БД и СУБД путают, можно услышать фразу “БД PostgreSQL” когда имелось ввиду “СУБД PostgreSQL”
Что такое РСУБД?

Реляционная система управления базами данных, РСУБД / Relational Database Management System (RDBMS) — СУБД которая хранит данные в виде таблиц и строк в этих таблицах. Любая данные в РСУБД должны быть структурированы в соответствии с реляционной моделью. Примеры РСУБД:

    MySQL
    PostgreSQL
    MSSQL
    Oracle

**PostgreSQL**

_**SQL**_ - язык структурированных запросовStructured Query Language

**_SQL_** — декларативный язык программирования, предназначенный для 
описания, изменения и извлечения данных из СУБД. Чаще всего используется в реляционных СУБД.
Таблица, строка, столбец

    Таблица — совокупность строк и столбцов
    Строка — запись в БД о конкретной сущности
    Столбец — любой атрибут сущности хранящейся в строке

Типы данных: числовые

    serial — целое с автоувеличением, от 1 до 2147483647
    smallint, int2 — целое, от -32768 до +32767;
    integer, int, int4 — целое, от -2147483648 до +2147483647
    bigint, int8 — целое, от -9 223 372 036 854 775 808 до 9 223 372 036 854 775 807
    double precision, float8 — с плавающей точкой, от 1E-307 до 1E+308

Типы данных: стоковые

    character(n), char(n) — представляет строку из фиксированного количества символов. С помощью параметра задается задается количество символов в строке

    character varying(n), varchar(n) - представляет строку из фиксированного количества символов. С помощью параметра задается задается количество символов в строке

    text — представляет текст произвольной длины

Типы данных: время и даты

    timestamp — хранит дату и время, с учётом часового пояса или без. Для дат самое нижнее значение 4713 год до н. э., самое верхнее значение 294276 год н. э.
    date — представляет дату от 4713 год до н. э. до 5874897 года н.э
    time — хранит время суток, без даты, с учётом часового пояса или без. Принимает значения от 00:00:00 до 24:00:00

Типы данных: прочие

    boolean — булево значение, true или false
    jsonb — данные произвольного формата в формате JSON

**Data Definition Language, Data Control Language:**

**DDL** — подмножество языка SQL, предназначенное для создания, изменения и удаления баз данных и таблиц в них. К нему относятся все команды, начинающиеся с CREATE, ALTER и DROP.

**DCL** — подмножество языка SQL, предназначенное для управления правами доступа к базам данным и таблицам в них. С помощью него можно разрешить и запрещать пользователям создавать, изменять и удалять базы данных или таблицы. К нему относятся все команды, начинающиеся на `GRANT` и `REVOKE`.
SQL: создание пользователя СУБД

```sql
CREATE USER test_user WITH PASSWORD 'qwerty';
```

Пользователь создаётся именно в СУБД!

**SQL: создание базы данных**

```sql
CREATE DATABASE test_db OWNER test_user;`
```

Любая база должна быть создана, прежде чем к ней можно будет подключиться. Пользователь, указанный как owner, будет иметь максимальные права доступа к этой базе данных.
SQL: права пользователя в БД

```sql
GRANT ALL PRIVILEGES ON DATABASE test_db TO test_user;
```

По умолчанию доступ к базе имеет только owner и супер-администратор СУБД. Всем остальным пользователям доступ нужно добавлять явным образом.
SQL: удаление базы данных

```
DROP DATABASE test_db;
```

Удалить базу данных может её владелец, супер-администратор СУБД или пользователь, которому явным образом даны на это права.
SQL: создание таблицы

```
CREATE TABLE students (

id serial PRIMARY KEY, 
name varchar(80), 
age integer

);
```
_**Data Manipulation Language**_

DML — подмножество языка SQL, предназначенное для создания, изменения и удаления данных в таблицах внутри базы данных. К нему относятся все команды, начинающиеся с `SELECT`, `INSERT`, `UPDATE` и `DELETE`. (`CRUD` аббревиатура CREATE READ UPDATE DELETE) В целом SQL DML очень похожи среди разных баз данных, но иногда бывают серьезные отличия, поэтому всегда полезно сверяться с документацией по конкретной БД в случае проблем.
SQL: добавление строк в таблицу

```
INSERT INTO students (name, age) VALUES
('Anna', 25),
('Maria', 23),
('Roman', 28);
```

Обратите внимание, что поле id существует в таблице, но указывать его значение не обязательно. Тип данных serial позволяет ему заполняться автоматически.
SQL: извлечение данных

```
1. SELECT * FROM students;
2. SELECT name, age FROM students;
3. SELECT * FROM students WHERE age < 18;
4. SELECT * FROM students ORDER BY age ASC;
5. SELECT AVG(age) AS 'Средний возраст' FROM students;
```

С помощью `SELECT` можно не просто вытаскивать данные, но и проводить фильтрацию, сортировать и проводить несложные агрегации.
SQL: изменение данных

```
UPDATE students SET age = 26 WHERE name = 'Anna';
```

С помощью `UPDATE` можно изменять любые данные в таблице. Использование WHERE не обязательно, хотя и крайне рекомендуется. Без WHERE будут обновлены все существующие строчки в таблице.
SQL: удаление данных

```
DELETE FROM students WHERE id = 1;
```


Чаще всего удаление происходит по `id`, но можно удалять и по любому другому полю:

```
DELETE FROM students WHERE name = 'Anna';
```

Возможно использование `DELETE` вообще без `WHERE`, в таком случае будут удалены вообще все данные в таблице.

**HOMEWORK:** 

_**Задание 1**_

Пройдите игру SQL Island до 13-го уровня (Step #13).

Пришлите в личном сообщении номер уровня до которого дошли. Если вы застряли попросите помощи одногруппника (или преподавателя).

Ссылка на игру на немецком: [ссылка](http://sql-island.informatik.uni-kl.de/?lang=de)

Ссылка на игру на английском: [ссылка](http://sql-island.informatik.uni-kl.de/?lang=en)


```markdown
code/README.md

Добрый день, коллеги!

Завтра начинается курс баз данных! Будет здорово, если вы немного подготовитесь и установите себе PostgreSQL Server – сам сервер СУБД и Beekeeper Studio.
Если у вас Windows:

Вот инструкция на установку: https://winitpro.ru/index.php/2019/10/25/ustanovka-nastrojka-postgresql-v-windows/

Ссылка на установщик: https://www.postgresql.org/download/

Имя юзера: postgres

Выберите пароль для суперюзера: qwerty007

Только на реальных проектах не используйте такие пароли! :ghost:

    https://github.com/beekeeper-studio/beekeeper-studio/releases/tag/v4.0.3 переходите по ссылке и скачиваете и устанавливаете Beekeeper-Studio-Setup-4.0.3.exe (можете выбрать другой из списка, если он подходит лучше)

Если у вас MAC OS:

устанавливаете два приложения по двум ссылкам ниже:

    https://postgresapp.com/
    https://github.com/beekeeper-studio/beekeeper-studio/releases/tag/v4.0.3 переходите по ссылке и скачиваете и устанавливаете Beekeeper-Studio-Setup-4.0.3.dmg (можете выбрать другой из списка, если он подходит лучше)

Если установили, пришлите мне в личку +, если не получилось -
./code/queries.sql

-- создание БД
CREATE DATABASE geography OWNER postgres;

-- создание таблицы
CREATE TABLE countries (
id serial PRIMARY KEY,
name varchar(80),
population integer,
area integer
);

-- добавление данных
INSERT INTO countries (name, population, area) VALUES
('Германия', 82000000, 357592),
('Россия', 147000000, 20000000),
('Китай', 1400000000, 9597000),
('Эльдорадо', 1000, 100000),
('МВидео', 5000000, 200000);

-- показать все страны
SELECT
*
FROM
countries;

-- показать все страны в алфавитном порядке
-- если у нас русский язык понадобится доп настройка
SELECT
name
FROM
countries
ORDER BY
name ASC; -- по возрастанию

SELECT
name
FROM
countries
ORDER BY
name DESC; -- по убыванию

-- вывести все страны с населением больше 100 млн человек
SELECT
*
FROM
countries
WHERE
population > 100000000;

-- изменить население страны по названию
UPDATE
countries
SET
population = 90000000
WHERE
name = 'Германия';

-- изменить площадь страны если в ней живёт больше 1 млрд чел
UPDATE
countries
SET
area = 15000000
WHERE
population > 1000000000;

-- удалить страну по названию
DELETE FROM
countries
WHERE
name = 'МВидео';

-- удалить страну с населением меньше 1000000
DELETE FROM
countries
WHERE
population < 1000000;

-- Удалить страну с населением больше 100 млн чел и площадью меньше 200 млн
DELETE FROM
countries
WHERE
population > 100000000 AND area < 200000000;
```
